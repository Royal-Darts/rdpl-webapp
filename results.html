<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Results | Royal Darts Premier League 2025</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- Navigation -->
  <nav id="main-nav" class="glass-nav">
    <div class="nav-logo">
      <img src="logo.png" alt="RDPL Logo" />
      <span>Royal Darts Premier League 2025</span>
    </div>
    <ul class="nav-links">
      <li><a href="index.html" class="nav-link">Home</a></li>
      <li><a href="fixtures.html" class="nav-link">Fixtures</a></li>
      <li><a href="results.html" class="nav-link active">Results</a></li>
      <li><a href="standings.html" class="nav-link">Standings</a></li>
      <li><a href="squads.html" class="nav-link">Squads</a></li>
      <li><a href="stats.html" class="nav-link">Stats</a></li>
      <li><a href="live.html" class="nav-link">Live</a></li>
    </ul>
  </nav>
  <main>
    <h1>Results</h1>
    <div id="results-content">Loading results...</div>
  </main>
  <footer class="footer">
    <p>Built by SUCA Analytics</p>
    <a href="https://wa.me/?text=Check%20out%20the%20Royal%20Darts%20Premier%20League%202025%20website!" target="_blank" aria-label="Share on WhatsApp" class="whatsapp-share">
      <img src="whatsapp-icon.svg" alt="WhatsApp" />
    </a>
  </footer>
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycby6BCE5cyBaxpz-Jt-TeRH6k5Jeq-vqelr8S7rt32e7wFjBzEvuBrYi4yPaEBz2Kari/exec';
    async function fetchJSON(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP error ${res.status}`);
        return await res.json();
      } catch (err) {
        console.error('Fetch error:', err);
        return null;
      }
    }
    function createEl(type, classes = [], text = '') {
      const el = document.createElement(type);
      if (classes.length) el.classList.add(...classes);
      if (text) el.textContent = text;
      return el;
    }
    // Helper: group by date
    function groupResultsByDate(results) {
      const map = {};
      results.forEach(r => {
        let d = r['Date'] || '';
        if (d.length > 10) d = d.slice(0, 10);
        if (!map[d]) map[d] = [];
        map[d].push(r);
      });
      return map;
    }
    function formatDate(dateStr) {
      if (!dateStr) return '';
      try {
        const d = new Date(dateStr);
        return d.toLocaleDateString(undefined, {weekday:'short',year:'numeric',month:'short',day:'numeric'});
      } catch { return dateStr; }
    }
    async function renderResults() {
      const content = document.getElementById('results-content');
      const data = await fetchJSON(API_URL);
      if (!data || !Array.isArray(data.Results) || !data.Results.length) {
        content.textContent = 'No results found.';
        return;
      }
      // Merge in date from Fixtures if possible
      const matchIdToDate = {};
      if (data.Fixtures) {
        data.Fixtures.forEach(fx => {
          if (fx['Match No'] && fx.Date) matchIdToDate[fx['Match No']] = fx.Date;
        });
      }
      // Attach date to results
      data.Results.forEach(r => {
        // Try to match on Match No or Match ID if possible (not guaranteed)
        // Otherwise use a fake placeholder
        r.Date = r.Date || '';
      });

      // Group by date
      const resultsByDate = groupResultsByDate(data.Results);
      content.innerHTML = '';
      Object.entries(resultsByDate).forEach(([date, matches]) => {
        const dateSection = createEl('section', ['results-date-section']);
        const header = createEl('h2', [], formatDate(date));
        dateSection.appendChild(header);
        // Group by A/B
        ['A','B'].forEach(group => {
          const groupMatches = matches.filter(m => m.Group === group);
          if (groupMatches.length) {
            const groupTitle = createEl('h3', [], `Group ${group}`);
            dateSection.appendChild(groupTitle);
            const table = document.createElement('table');
            table.className = 'results-table';
            table.innerHTML = `<thead>
              <tr>
                <th>Team 1</th>
                <th>Legs</th>
                <th>Avg</th>
                <th></th>
                <th>Team 2</th>
                <th>Legs</th>
                <th>Avg</th>
              </tr></thead><tbody>
              ${groupMatches.map(r => {
                let winner = r['Legs 1'] > r['Legs 2'] ? 1 : (r['Legs 2'] > r['Legs 1'] ? 2 : 0);
                return `<tr>
                  <td class="${winner===1?'winner-cell':''}"><img src="team_logos/${r['Team 1']}.png" alt="${r['Team 1']}" class="team-logo-sm"/> ${r['Team 1']}</td>
                  <td${winner===1?' class="winner-cell"':''}>${r['Legs 1']}</td>
                  <td${winner===1?' class="winner-cell"':''}>${r['Avg 1']||''}</td>
                  <td style="text-align:center;">vs</td>
                  <td class="${winner===2?'winner-cell':''}"><img src="team_logos/${r['Team 2']}.png" alt="${r['Team 2']}" class="team-logo-sm"/> ${r['Team 2']}</td>
                  <td${winner===2?' class="winner-cell"':''}>${r['Legs 2']}</td>
                  <td${winner===2?' class="winner-cell"':''}>${r['Avg 2']||''}</td>
                </tr>`;
              }).join('')}
            </tbody>`;
            dateSection.appendChild(table);
          }
        });
        // Playoffs/others
        const others = matches.filter(m => m.Group !== 'A' && m.Group !== 'B');
        if (others.length) {
          const groupTitle = createEl('h3', [], 'Playoffs / Finals');
          dateSection.appendChild(groupTitle);
          const table = document.createElement('table');
          table.className = 'results-table';
          table.innerHTML = `<thead>
            <tr>
              <th>Group</th>
              <th>Team 1</th>
              <th>Legs</th>
              <th></th>
              <th>Team 2</th>
              <th>Legs</th>
            </tr></thead><tbody>
            ${others.map(r =>
              `<tr>
                <td>${r.Group}</td>
                <td>${r['Team 1']}</td>
                <td>${r['Legs 1']}</td>
                <td style="text-align:center;">vs</td>
                <td>${r['Team 2']}</td>
                <td>${r['Legs 2']}</td>
              </tr>`
            ).join('')}
          </tbody>`;
          dateSection.appendChild(table);
        }
        content.appendChild(dateSection);
      });
    }
    document.addEventListener('DOMContentLoaded', renderResults);
  </script>
  <style>
    .results-date-section { margin-bottom: 2rem;}
    .results-table { width:100%; border-collapse:collapse; color:#e1e8f0; margin-bottom: 1rem;}
    .results-table th, .results-table td { padding:0.5rem 0.5rem; text-align:left; border-bottom:1px solid rgba(255,255,255,0.08);}
    .results-table th { color:#f2c94c;}
    .team-logo-sm {height:20px; width:auto; margin-right:0.5rem;vertical-align:middle;}
    .winner-cell {background:rgba(242,201,76,0.13)!important;color:#f2c94c;font-weight:700;}
    @media(max-width:700px){
      .results-table td, .results-table th{ font-size:0.96em;}
    }
  </style>
</body>
</html>
