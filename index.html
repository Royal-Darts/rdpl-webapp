<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Darts Carnival 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#a81100">
  <link rel="icon" type="image/avif" href="https://i.postimg.cc/jSXT8DK8/temp-Image-El-Y5kn.avif">
  <!-- Google Fonts: Inter + Orbitron for premium look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Orbitron:wght@900&display=swap" rel="stylesheet">
  <!-- Lucide icons CDN for premium iconography -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root {
      --primary: #a81100;
      --gold: #ffe174;
      --silver: #e6e9f4;
      --eliminated: #ffe4e4;
      --highlight: #fffbe7;
      --background: linear-gradient(135deg,#f5f6fa 0%,#f3f1ff 100%);
      --surface: rgba(255,255,255,0.87);
      --accent: #192347;
      --border: #e3e6ee;
      --radius: 20px;
      --shadow: 0 6px 30px rgba(20,16,52,0.09);
      --shadow-lg: 0 12px 44px 0 rgba(20,16,52,0.14);
      --nav-z: 100;
      --badge-size: 1.06em;
      --animation-fade: fadein 0.6s cubic-bezier(.22,.68,0.32,1.01);
      --stat-glass: blur(12px) saturate(120%);
      --stat-backdrop: rgba(255,255,255,0.82);
    }
    @keyframes fadein {
      0% { opacity: 0; transform: translateY(16px) scale(0.98);}
      100% { opacity: 1; transform: none;}
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: var(--background);
      min-height: 100vh;
      color: var(--accent);
    }
    body { display: flex; flex-direction: column; min-height: 100vh; }
    header {
      background: var(--surface);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      padding: 0 8px 0 0;
      min-height: 62px;
      position: sticky; top: 0; z-index: var(--nav-z);
      width: 100vw;
      transition: box-shadow 0.2s;
      animation: var(--animation-fade);
    }
    header img {
      width: 48px; height: 48px;
      min-width: 32px; min-height: 32px;
      border-radius: 50%;
      background: #fff;
      object-fit: cover;
      box-shadow: 0 2px 8px #0002;
      margin-left: 11px;
    }
    .header-titlebox { flex:1; min-width:0; }
    .header-title {
      font-family: 'Orbitron', 'Inter', sans-serif;
      font-size: 1.38rem;
      font-weight: 900;
      letter-spacing: 0.04em;
      color: var(--primary);
      margin: 0 0 0 10px;
      text-shadow: 0 2px 10px #fff7, 0 1px 2px #a8110044;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .nav-horiz {
      display: flex; gap: 2px; align-items: flex-end; margin-right: 12px;
    }
    .nav-horiz button {
      background: none; border: none;
      color: var(--accent);
      font-size: 1rem;
      min-width: 74px;
      padding: 11px 15px 8px 15px;
      font-weight: 600;
      border-radius: 20px 20px 0 0;
      margin: 0 2px;
      cursor: pointer;
      transition: background 0.18s, color 0.2s;
      position: relative;
      letter-spacing: 0.01em;
    }
    .nav-horiz button.active,
    .nav-horiz button:focus-visible {
      background: linear-gradient(90deg,#a81100 70%,#e34c15 100%);
      color: #fff;
    }
    .nav-horiz button.active::after {
      content: '';
      display: block;
      position: absolute;
      left: 19%;
      bottom: -4px;
      width: 62%;
      height: 3.5px;
      background: linear-gradient(90deg,#ffe174 70%,#ffdb92 100%);
      border-radius: 3px;
      box-shadow: 0 3px 11px #a8110055;
      animation: fadein 0.5s;
    }
    main {
      flex: 1;
      padding: 24px 0 27px 0;
      max-width: 1160px;
      margin: 0 auto;
      width: 100%;
      min-height: 62vh;
      display: flex; flex-direction: column; gap: 20px;
    }
    section[hidden] { display: none !important; }
    .tab-title {
      font-size: 1.18em;
      font-weight: 800;
      margin: 23px 0 13px 6px;
      color: var(--primary);
      letter-spacing: 0.03em;
      font-family: 'Orbitron', 'Inter', sans-serif;
    }

    /* Fixtures / Results */
    .fixtures-list .date-label, .results-list .date-label {
      font-family: 'Orbitron', 'Inter', sans-serif;
      font-size: 1.1em;
      font-weight: 700;
      background: linear-gradient(90deg,#ffe17488 50%,#fff 100%);
      color: #d77f0b;
      border-radius: 14px;
      margin: 21px 0 9px 3px;
      display: inline-block;
      padding: 5px 19px;
      box-shadow: 0 2px 12px #ffc83d21;
      position: relative;
    }
    .fixtures-list table, .results-list table {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: 0 2px 15px #0002;
      overflow: hidden;
      margin-bottom: 17px;
      width: 100%;
      animation: var(--animation-fade);
    }
    .fixtures-table th, .results-list th, .fixtures-table td, .results-list td {
      padding: 12px 5px;
      font-size: 1em;
      text-align: center;
    }
    .fixtures-table th, .results-list th {
      background: #fffbe9;
      color: #a81100;
      font-weight: 900;
      border-bottom: 2.5px solid #ffe174;
      font-family: 'Orbitron',sans-serif;
    }
    .fixtures-table td, .results-list td {
      border-bottom: 1px solid #f6eed9;
      background: transparent;
      font-weight: 600;
    }
    .fixtures-table tr, .results-list tr { transition: background 0.2s; }
    .fixtures-table tr:hover, .results-list tr:hover { background: #fff7e2; }

    .fixture-badge, .badge-gold, .badge-silver, .badge-elim {
      display: inline-block;
      font-size: var(--badge-size);
      font-weight: 700;
      padding: 4px 12px;
      border-radius: 16px;
      margin-left: 10px;
      box-shadow: 0 1px 6px #0001;
      background: #ffe174;
      color: #b36a00;
      border: 1.5px solid #ffe174;
      letter-spacing: 0.03em;
      opacity: 0.92;
      font-family: 'Inter',sans-serif;
    }
    .badge-gold { background: linear-gradient(90deg,#ffe174 90%,#fff7d6 100%); color: #935f07; }
    .badge-silver { background: linear-gradient(90deg,#e6e9f4 90%,#fff 100%); color: #596080; }
    .badge-elim { background: #ffe4e4; color: #cb1e34; border: 1.5px solid #ffc1c7; }
    .winner-cell {
      font-weight: 900; color: #29c300; background: #e6ffe6;
      border-radius: 12px; font-size: 1.07em; letter-spacing:0.02em;
      box-shadow: 0 1px 7px #90e3a740;
      animation: fadein 0.5s;
    }

    /* Standings */
    .quick-standings, .standings-table {
      margin-top: 18px;
      margin-bottom: 9px;
      border-radius: var(--radius);
      box-shadow: 0 2px 14px #0001;
      background: var(--surface);
      overflow: hidden;
      width: 100%;
      animation: var(--animation-fade);
    }
    .quick-standings th, .standings-table th {
      background: #f6f6fa;
      font-size: 1em;
      font-weight: 900;
      color: var(--primary);
      letter-spacing: 0.01em;
      padding: 10px 6px;
    }
    .quick-standings td, .standings-table td {
      padding: 8px 4px;
      text-align: center;
      font-size: 0.97em;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
    }
    .cup-gold { background: linear-gradient(90deg, var(--gold) 90%, #fff 100%);}
    .cup-silver { background: linear-gradient(90deg, var(--silver) 95%, #fff 100%);}
    .cup-eliminated { background: var(--eliminated);}
    .standings-table td:last-child {
      font-weight:900; border-left:2.5px solid #ffd77b; background:#fff6df;
      font-family:'Orbitron',sans-serif;
    }

    /* Highlights */
    .highlight-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(222px, 1fr));
      gap: 22px 33px;
      margin-bottom: 13px;
    }
    .stat-card {
      background: var(--stat-backdrop);
      backdrop-filter: var(--stat-glass);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 23px 25px 20px 24px;
      display: flex; flex-direction: column;
      align-items: flex-start;
      min-height: 112px;
      justify-content: center; gap: 8px;
      animation: var(--animation-fade);
      position: relative;
      overflow: visible;
    }
    .stat-card .label {
      font-size: 1.13rem;
      font-weight: 800;
      color: var(--primary);
      opacity: .93;
      margin-bottom: 1px;
      letter-spacing: 0.01em;
      font-family:'Orbitron',sans-serif;
      text-shadow: 0 1px 6px #ffd97631;
    }
    .stat-card .value {
      font-size: 2.21rem;
      font-weight: 900;
      color: #1c2257;
      letter-spacing: 0.01em;
      line-height: 1.04;
      margin-top: 1px;
      font-family:'Orbitron',sans-serif;
      text-shadow: 0 2px 12px #fff4, 0 2px 3px #a811001c;
      animation: pulseup 1.3s cubic-bezier(.34,1.56,.64,1) 1;
    }
    @keyframes pulseup { 0%{transform:scale(1.08);} 100%{transform:scale(1);} }
    .stat-card .player {
      font-size: 1.11rem;
      font-weight: 500;
      color: var(--accent);
      opacity: 0.86;
      display: flex; align-items: center; gap:7px;
    }
    .stat-card .player::before {
      content:"";
      display: inline-block;
      width: 19px; height: 19px;
      background: linear-gradient(135deg,#ffe174 70%,#e3e3e7 100%);
      border-radius: 50%; margin-right:2px;
      box-shadow: 0 2px 8px #fff7;
    }
    .highlight-footer {
      color: #888; font-size: 1.03em; margin-bottom: 28px; margin-left: 6px; margin-top: 6px; font-style: italic; letter-spacing: 0.01em;
      font-family: 'Inter',sans-serif;
    }
    /* Top 10 page */
    .top10-list-section { margin-bottom: 31px;}
    .top10-list-title {
      font-weight: 900;
      font-size: 1.15em;
      color: var(--primary);
      margin: 7px 0 7px 0;
      font-family:'Orbitron',sans-serif;
      letter-spacing:0.01em;
      display:flex; align-items:center; gap:10px;
    }
    .info-icon {
      display: inline-block;
      font-size: 1.13em;
      color: #268aff;
      background: #e7f3fe;
      border-radius: 50%;
      width: 1.36em; height: 1.36em;
      text-align: center;
      font-weight: 800;
      cursor: pointer;
      margin-left: 7px;
      margin-bottom: -1px;
      line-height: 1.36em;
      box-shadow: 0 2px 5px #acd2ff22;
      transition: box-shadow 0.19s;
    }
    .info-icon:hover { box-shadow: 0 2px 14px #acd2ff55;}
    .top10-list-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--surface);
      box-shadow: 0 2px 14px #0001;
      border-radius: 15px;
      overflow: hidden;
      animation: var(--animation-fade);
    }
    .top10-list-table th {
      background: #f5f5fa;
      color: var(--primary);
      font-size: 1em;
      font-weight: 800;
      padding: 11px 6px;
      position:relative;
      cursor: pointer;
      user-select: none;
      letter-spacing: 0.01em;
    }
    .top10-list-table td {
      padding: 9px 4px; font-size: 1.05em;
      font-family:'Inter',sans-serif;
    }
    .top10-list-table tr:nth-child(2) td { background: #ffe17427; font-weight: 900;}
    .top10-list-table tr:nth-child(3) td { background: #ffe17414; font-weight: 800;}
    .top10-list-table tr:nth-child(4) td { background: #e6e9f417; font-weight: 800;}
    .top10-list-table td button {
      color: var(--primary);
      font-weight: 700;
      background: none;
      border: none;
      cursor: pointer;
    }

    /* Search box and stats table */
    #stats-search {
      width: 98%;
      max-width: 350px;
      padding: 12px 12px;
      border-radius: 21px;
      border: 1.6px solid #ecd7bf;
      margin: 11px 0 20px 0;
      font-size: 1.06em;
      background: #fff;
      color: #233;
      box-shadow: 0 2px 10px #ffe17417;
      transition: border .18s;
    }
    #stats-search:focus { border-color: #ffe174;}
    .stats-table th, .stats-table td {
      padding: 9px 7px;
      text-align: center;
      font-size: 0.98em;
      border-bottom: 1px solid #f1eadc;
      transition: background 0.16s;
    }
    .stats-table th { background: #faf2df; color: #a81100; font-weight:800; }
    .stats-table tr:hover { background: #fdf4dd; }
    .player-link { color: #a81100; font-weight:700; text-decoration: underline dotted; cursor: pointer; background: none; border:none;}
    .player-link:hover { color:#fff; background:#a81100; border-radius:12px; transition: all 0.15s;}
    /* Popups & Cards (Blurred) */
    .popup-backdrop {
      display: none;
      position: fixed; z-index: 999;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: #121b3dbb;
      align-items: center; justify-content: center;
      overflow: auto;
      animation: fadein 0.28s;
    }
    .popup-backdrop.show { display: flex; }
    .popup-card, .info-popup-card, .teamstats-popup-card {
      background: var(--stat-backdrop);
      backdrop-filter: var(--stat-glass);
      border-radius: 22px;
      box-shadow: var(--shadow-lg);
      padding: 20px 13px 15px 13px;
      max-width: 96vw;
      min-width: 0;
      width: 350px;
      display: flex; flex-direction: column;
      align-items: center;
      position: relative;
      animation: popupAppear 0.22s cubic-bezier(.68,-0.55,.27,1.55);
      max-height: 92vh; overflow-y: auto;
      font-family: 'Inter',sans-serif;
    }
    .popup-card img { width: 66px; height: 66px; border-radius: 50%; object-fit: cover; border: 3px solid #ffe174; background: #fff; margin-bottom: 7px; }
    .popup-card .name { font-size: 1.27rem; font-weight: 900; color: var(--primary);}
    .popup-card .team { font-size: 1.08rem; color: #555; margin-bottom: 10px;}
    .popup-card .close-btn, .info-popup-card .close-btn, .teamstats-popup-card .close-btn {
      position: absolute; top: 12px; right: 17px; font-size: 2.1em; color: #aaa; background: none; border: none; cursor: pointer; z-index: 2;
    }
    .popup-card .close-btn:hover, .info-popup-card .close-btn:hover, .teamstats-popup-card .close-btn:hover { color: var(--primary);}
    .save-card-btn {
      margin-top: 13px;
      background: linear-gradient(90deg,#a81100 70%,#e34c15 100%);
      color: #fff;
      font-weight: 900;
      padding: 10px 21px;
      border: none;
      border-radius: 18px;
      font-size: 1.09em;
      box-shadow: 0 3px 10px #ffe17428;
      cursor: pointer;
      transition: background 0.14s;
      font-family:'Orbitron',sans-serif;
    }
    .save-card-btn:hover { background: #e34c15; }
    /* Squads, player cards, team sections */
    .squad-player-card { box-shadow:0 1px 12px #ffe17416; border-radius:15px; padding:14px 10px 14px 10px; background:var(--surface); font-size:1.09em; min-height:79px; }
    .squad-player-card button { font-size:1.1em; font-weight:700; background:none; color:var(--primary);}
    .squad-player-card button:hover { text-decoration: underline;}
    .squad-sets { color:#555; font-size:0.98em; margin-top:3px;}
    .squad-team-name { font-size:1.17em; font-weight:900; color:var(--primary);}
    /* Footer */
    footer {
      text-align: center;
      font-size: 1.09em;
      color: #fff;
      background: linear-gradient(90deg,#a81100 60%,#e34c15 100%);
      font-family: 'Orbitron', 'Inter', sans-serif;
      padding: 18px 0 18px 0;
      letter-spacing:0.03em;
      margin-top: 37px;
      border-radius: 20px 20px 0 0;
      box-shadow:0 -4px 20px #e34c1542;
    }
    /* Responsive & Misc */
    @media (max-width:700px) {
      main { padding:10px 0 24px 0; }
      .header-title { font-size:1.02rem;}
      .popup-card, .info-popup-card, .teamstats-popup-card { width:99vw; max-width:99vw;}
      .stat-card { padding: 13px 11px 15px 13px;}
    }
    @media (max-width:500px) {
      .popup-card, .info-popup-card, .teamstats-popup-card { padding: 9px 2vw 7px 2vw;}
      .highlight-cards { grid-template-columns: 1fr; }
    }
    /* Animations for fadein, pulse, etc are above */
  </style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
<header>
  <img src="https://i.postimg.cc/jSXT8DK8/temp-Image-El-Y5kn.avif" alt="Royal Darts Carnival 2025 Logo" loading="lazy">
  <div class="header-titlebox"><div class="header-title">Darts Carnival 2025</div></div>
  <div class="nav-horiz" id="nav-horiz">
    <button data-tab="home" class="active" aria-current="page">Home</button>
    <button data-tab="fixtures">Fixtures</button>
    <button data-tab="results">Results</button>
    <button data-tab="standings">Standings</button>
    <button data-tab="stats">Stats</button>
    <button data-tab="top10">Top 10</button>
    <button data-tab="live">Live</button>
    <button data-tab="squads">Squads</button>
  </div>
</header>
<main>
  <!-- Home -->
  <section id="tab-home">
    <div class="tab-title">Today’s Fixtures</div>
    <div class="fixtures-list" id="today-fixtures"></div>
    <div class="tab-title">Quick Standings</div>
    <table class="quick-standings" id="quick-standings"></table>
    <div class="tab-title">Stat Highlights</div>
    <div class="highlight-cards" id="stat-highlights"></div>
    <div class="highlight-footer">*2 matches min played</div>
  </section>
  <!-- Fixtures -->
  <section id="tab-fixtures" hidden>
    <div class="tab-title">All Fixtures</div>
    <div class="fixtures-list" id="fixtures-list"></div>
  </section>
  <!-- Results -->
  <section id="tab-results" hidden>
    <div class="tab-title">All Results</div>
    <div class="results-list" id="results-list"></div>
  </section>
  <!-- Standings -->
  <section id="tab-standings" hidden>
    <div class="tab-title">Group Standings</div>
    <div id="standings-tables"></div>
  </section>
  <!-- Stats -->
  <section id="tab-stats" hidden>
    <div class="tab-title">Player Statistics</div>
    <input id="stats-search" placeholder="Search player...">
    <div style="overflow-x:auto">
      <table class="stats-table" id="stats-table"></table>
    </div>
  </section>
  <!-- Top 10 -->
  <section id="tab-top10" hidden>
    <div class="tab-title">Top 10 Rankings</div>
    <div id="top10-tables"></div>
  </section>
  <!-- Live -->
  <section id="tab-live" hidden>
    <iframe id="live-iframe" src="https://n01darts.com/n01/tournament/comp.php?id=t_OxWz_6427&tab=live"
      style="width:100%;height:72vh;border-radius:18px;border:none;box-shadow:0 2px 20px #0002;"></iframe>
  </section>
  <!-- Squads -->
  <section id="tab-squads" hidden>
    <div class="tab-title">Squads / Player List</div>
    <div class="squad-team-filter-row" style="margin-bottom:12px;">
      <label for="squad-team-filter">Team:</label>
      <select id="squad-team-filter" class="squad-team-filter">
        <option value="">All Teams</option>
      </select>
    </div>
    <div id="squads-list"></div>
  </section>
</main>
<!-- Popups: Player, Info, TeamStats -->
<div class="popup-backdrop" id="popup-backdrop" tabindex="-1" aria-modal="true" role="dialog" style="display:none"></div>
<footer>
  Built by SUCA Analytics
</footer>
<script>
  // CONFIGURATION: Update with your API/fixtures endpoints as needed
  const API_URL = "https://script.google.com/macros/s/AKfycbxg9ASk6TWcgMn4O25XgTtHdxOULY-Dlw6UpcyzWpBwEXXlNS_FoOi4BVjR4HBS55QU7A/exec";
  const FIXTURES_JSON_URL = "csvjson.json"; // Deployed in your root

  let allData = {}, statsData = [], standingsData = [], fixturesData = [], resultsData = [];
  let filteredStats = [];
  let lastSort = {col:null, asc:true};

  // 1. NAVIGATION + RESPONSIVE DRAWER
  document.addEventListener('DOMContentLoaded', () => {
    setupNavigation();
    setupDrawer();
    fetchAllData();
    setInterval(fetchAllData, 60000);
  });

  function setupDrawer() {
    const burgerBtn = document.getElementById('burger-btn');
    const backdrop = document.getElementById('drawer-backdrop');
    const drawer = document.querySelector('.drawer-nav');
    const closeBtn = document.getElementById('drawer-close');
    const navLinks = drawer.querySelectorAll('.drawer-links button');
    burgerBtn.onclick = () => { backdrop.classList.add('show'); };
    closeBtn.onclick = () => { backdrop.classList.remove('show'); };
    backdrop.onclick = (e) => { if(e.target === backdrop) { backdrop.classList.remove('show'); } };
    navLinks.forEach(btn => {
      btn.onclick = () => {
        backdrop.classList.remove('show');
        activateTab(btn.dataset.tab);
      };
    });
  }
  function setupNavigation() {
    document.querySelectorAll('nav button, .drawer-links button').forEach(btn => {
      btn.onclick = () => { activateTab(btn.dataset.tab); };
    });
  }
  function activateTab(tab) {
    document.querySelectorAll('nav button, .drawer-links button').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tab);
      if(btn.dataset.tab === tab) btn.setAttribute('aria-current','page');
      else btn.removeAttribute('aria-current');
    });
    document.querySelectorAll('main > section').forEach(sec => sec.hidden = true);
    document.getElementById('tab-' + tab).hidden = false;
  }

  // 2. FETCH DATA (API and local fixtures json)
  async function fetchAllData() {
    try {
      let res = await fetch(API_URL + "?cachebust=" + Math.random());
      allData = await res.json();
      statsData = allData["PlayerStats"] || [];
      standingsData = allData["Standings"] || [];
      resultsData = allData["Results"] || [];
      fixturesData = await fetchFixturesJson(FIXTURES_JSON_URL);
      renderAll();
    } catch (err) {
      document.body.innerHTML = '<div style="padding:60px;text-align:center;color:#c00;font-size:1.22em;">Error loading tournament data.<br>'+err+'</div>';
    }
  }
  async function fetchFixturesJson(url) {
    let resp = await fetch(url + "?cb=" + Math.random());
    if (!resp.ok) return [];
    return await resp.json();
  }
  function asNum(val) {
    let v = (typeof val === "string" && val.trim()==="") ? NaN : Number(val);
    return isNaN(v) ? null : v;
  }
  function getCupByPosition(pos) {
    if (pos <= 3) return "gold";
    if (pos <= 5) return "silver";
    return "eliminated";
  }

  // UTILITY: Badge for knockout fixtures
  function getFixtureBadge(group) {
    if (!group) return '';
    let g = group.toLowerCase();
    if (g.includes('gold')) return `<span class="badge badge-gold">${group.replace("Gold ","Gold&nbsp;")}</span>`;
    if (g.includes('silver')) return `<span class="badge badge-silver">${group.replace("Silver ","Silver&nbsp;")}</span>`;
    if (g.includes('eliminator')) return `<span class="badge badge-elim">Eliminator</span>`;
    if (g.includes('qualifier')) return `<span class="badge badge-gold">Qualifier</span>`;
    if (g.includes('final')) return `<span class="badge badge-gold">${group}</span>`;
    return '';
  }

  // 3. RENDER EVERYTHING ON DATA LOAD
  function renderAll() {
    renderTodayFixtures();
    renderQuickStandings();
    renderStatHighlights();
    renderFixturesList();
    renderResultsList();
    renderStandingsTables();
    renderStatsTable();
    renderTop10Tables();
    renderSquadsList();
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  // ---- TODAY'S FIXTURES (with knockout badges) ----
  function renderTodayFixtures() {
    if (!fixturesData.length) {
      document.getElementById('today-fixtures').innerHTML =
        `<div style="color:#888;padding:12px">No fixtures scheduled for today.</div>`;
      return;
    }
    let today = new Date();
    let todayDay = today.getDate();
    let todayMonth = today.getMonth();
    let todays = fixturesData.filter(f => {
      if (!f.Date) return false;
      let parts = (f.Date+"").split(' ');
      if (parts.length < 2) return false;
      let day = parseInt(parts[0], 10);
      let monthStr = parts[1].toLowerCase();
      let monthNum = [
        "january","february","march","april","may","june","july","august",
        "september","october","november","december"
      ].indexOf(monthStr);
      return day === todayDay && monthNum === todayMonth;
    });
    if (!todays.length) {
      document.getElementById('today-fixtures').innerHTML =
        `<div style="color:#888;padding:12px">No fixtures scheduled for today.</div>`;
      return;
    }
    let out = `<table class="fixtures-table">
      <tr><th>Time</th><th>Team A</th><th></th><th>Team B</th><th></th></tr>`;
    todays.forEach(f => {
      out += `<tr>
        <td>${f.Time || ""}</td>
        <td>${f["Team A"]||""}</td>
        <td style="color:#a81100;font-weight:700;">vs</td>
        <td>${f["Team B"]||""}</td>
        <td>${getFixtureBadge(f.Group)}</td>
      </tr>`;
    });
    out += `</table>`;
    document.getElementById('today-fixtures').innerHTML = out;
  }

  // ---- FIXTURES PAGE ----
  function renderFixturesList() {
    if (!fixturesData.length) {
      document.getElementById('fixtures-list').innerHTML =
        `<div style="color:#888;padding:10px">No fixtures loaded.</div>`;
      return;
    }
    let byDate = {};
    fixturesData.forEach(f => {
      let dateLabel = f.Date || "";
      if (f["Team A"] && f["Team B"]) (byDate[dateLabel] = byDate[dateLabel]||[]).push(f);
    });
    let out = '';
    let dateKeys = Object.keys(byDate).sort((a,b)=>{
      let d1 = Date.parse(a + " 2025"), d2 = Date.parse(b + " 2025");
      return (isNaN(d1)||isNaN(d2)) ? a.localeCompare(b) : d1-d2;
    });
    dateKeys.forEach(dateLabel => {
      let matches = byDate[dateLabel];
      out += `<div style="margin-bottom:23px;">
        <span class="badge badge-date">${dateLabel}</span>
        <table class="fixtures-table" style="margin-top:7px">
          <tr><th>Time</th><th>Team A</th><th></th><th>Team B</th><th></th></tr>`;
      matches.forEach(f => {
        out += `<tr>
          <td>${f.Time || ""}</td>
          <td>${f["Team A"]}</td>
          <td style="color:#a81100;font-weight:700;">vs</td>
          <td>${f["Team B"]}</td>
          <td>${getFixtureBadge(f.Group)}</td>
        </tr>`;
      });
      out += `</table></div>`;
    });
    document.getElementById('fixtures-list').innerHTML = out;
  }

  // ---- QUICK STANDINGS (HOME) ----
  function renderQuickStandings() {
    if (!standingsData.length) return;
    let byGroup = {};
    standingsData.forEach(row => {
      let g = row.Group || "A";
      (byGroup[g] = byGroup[g]||[]).push(row);
    });
    let out = '';
    Object.entries(byGroup).forEach(([group, teams]) => {
      teams.sort((a, b) =>
        (+b.Points||0) - (+a.Points||0) ||
        ((asNum(b.For)-asNum(b.Against)) - (asNum(a.For)-asNum(a.Against))) ||
        (asNum(b.For) - asNum(a.For))
      );
      out += `<div style="margin-bottom:12px"><span class="badge badge-date">${group}</span>
        <table class="standings-table" style="margin-top:6px">
        <tr><th>Pos</th><th>Team</th><th>P</th><th>W</th><th>L</th><th>D</th><th>EW</th><th>EL</th><th>Pts</th></tr>`;
      teams.forEach((t,i) => {
        let cup = getCupByPosition(i+1);
        let ew = asNum(t.For) != null ? asNum(t.For) : "";
        let el = asNum(t.Against) != null ? asNum(t.Against) : "";
        out += `<tr class="cup-${cup}">
          <td>${i+1}</td><td>${t.Team}</td><td>${t.P}</td><td>${t.W}</td><td>${t.L}</td>
          <td>${t.D}</td><td>${ew}</td><td>${el}</td><td>${t.Points}</td>
        </tr>`;
      });
      out += `</table></div>`;
    });
    document.getElementById('quick-standings-card').innerHTML = out;
  }

  // ---- FULL STANDINGS PAGE ----
  function renderStandingsTables() {
    if (!standingsData.length) return;
    let byGroup = {};
    standingsData.forEach(row => {
      let g = row.Group || "A";
      (byGroup[g] = byGroup[g]||[]).push(row);
    });
    let out = '';
    Object.entries(byGroup).forEach(([group, teams]) => {
      teams.sort((a, b) =>
        (+b.Points||0) - (+a.Points||0) ||
        ((asNum(b.For)-asNum(b.Against)) - (asNum(a.For)-asNum(a.Against))) ||
        (asNum(b.For) - asNum(a.For))
      );
      out += `<div style="margin-bottom:28px">
        <span class="badge badge-date">${group}</span>
        <table class="standings-table" style="margin-top:7px">
          <tr><th>Pos</th><th>Team</th><th>P</th><th>W</th><th>L</th><th>D</th><th>EW</th><th>EL</th><th>Pts</th><th>Cup</th></tr>`;
      teams.forEach((t,i) => {
        let cup = getCupByPosition(i+1);
        let cupText = cup==='gold'?'Gold':cup==='silver'?'Silver':'Eliminated';
        let ew = asNum(t.For) != null ? asNum(t.For) : "";
        let el = asNum(t.Against) != null ? asNum(t.Against) : "";
        out += `<tr class="cup-${cup}">
          <td>${i+1}</td><td>${t.Team}</td><td>${t.P}</td><td>${t.W}</td><td>${t.L}</td>
          <td>${t.D}</td><td>${ew}</td><td>${el}</td>
          <td>${t.Points}</td><td>${cupText}</td>
        </tr>`;
      });
      out += `</table></div>`;
    });
    document.getElementById('standings-tables').innerHTML = out;
  }

  // ---- STAT HIGHLIGHTS (HOME) ----
  function renderStatHighlights() {
    if (!statsData.length) return;
    function bestStat(col, bestFn, postFn) {
      let arr = statsData.filter(p => asNum(p["Match Played"]) >= 2 && asNum(p[col]) !== null && p[col] !== "");
      if (!arr.length) return { value: "NA", player: "NA" };
      let best = arr.reduce((a, b) => bestFn(a,b), arr[0]);
      let tieArr = arr.filter(x => asNum(x[col]) === asNum(best[col]));
      let winner = tieArr.sort((a,b) => asNum(b["Match Played"]) - asNum(a["Match Played"]))[0];
      let val = asNum(winner[col]);
      if (postFn) val = postFn(val);
      return { value: val != null ? val : "NA", player: winner.Player || "NA" };
    }
    let highlights = [
      { label: "Best 3 Dart Avg", ...bestStat("3 Dart Avg", (a,b) => asNum(b["3 Dart Avg"])>asNum(a["3 Dart Avg"])?b:a) },
      { label: "Best Win Rate (Legs)", ...bestStat("Win Rate (Legs)", (a,b) => asNum(b["Win Rate (Legs)"])>asNum(a["Win Rate (Legs)"])?b:a, v => (v*100).toFixed(1)+"%") },
      { label: "Best Win Rate (Sets)", ...bestStat("Win Rate (Sets)", (a,b) => asNum(b["Win Rate (Sets)"])>asNum(a["Win Rate (Sets)"])?b:a, v => (v*100).toFixed(1)+"%") },
      { label: "High Finish", ...bestStat("High Finish", (a,b) => asNum(b["High Finish"])>asNum(a["High Finish"])?b:a) },
      { label: "Best First 9 Avg", ...bestStat("First 9 Avg", (a,b) => asNum(b["First 9 Avg"])>asNum(a["First 9 Avg"])?b:a) }
    ];
    document.getElementById('stat-highlights').innerHTML = highlights.map(h => `
      <div class="stat-card">
        <span class="label">${h.label}</span>
        <span class="value">${h.value}</span>
        <span class="player">${h.player}</span>
      </div>
    `).join('');
  }

  // ---- RESULTS PAGE (grouped by group/date) ----
  function renderResultsList() {
    if (!resultsData.length) {
      document.getElementById('results-list').innerHTML =
        `<div style="color:#888;padding:10px">No results loaded.</div>`;
      return;
    }
    let byGroup = {};
    resultsData.forEach(r => {
      let group = r.Group || "Other";
      (byGroup[group] = byGroup[group] || []).push(r);
    });
    let out = '';
    Object.entries(byGroup).forEach(([group, matches]) => {
      let byDate = {};
      matches.forEach(r => {
        let date = r.Date || '';
        (byDate[date] = byDate[date] || []).push(r);
      });
      out += `<div style="margin-bottom:24px;">
        <span class="badge badge-date">${group}</span>`;
      Object.entries(byDate).sort((a,b)=>{
        let d1=Date.parse(a[0]+" 2025"),d2=Date.parse(b[0]+" 2025");
        return (isNaN(d1)||isNaN(d2))?a[0].localeCompare(b[0]):d2-d1;
      }).forEach(([date, games]) => {
        out += `<div class="badge badge-date" style="margin-left:9px">${date}</div>
          <table class="results-table" style="margin-top:7px"><tr>
            <th>Team A</th><th></th><th>Team B</th><th>Score</th><th>Winner</th></tr>`;
        games.forEach(r => {
          let a = +r["Score A"]||0, b = +r["Score B"]||0;
          let win = r.Winner || (a > b ? r["Team A"] : b > a ? r["Team B"] : "Draw");
          out += `<tr>
            <td>${r["Team A"]}</td><td style="color:#a81100;font-weight:700;">vs</td>
            <td>${r["Team B"]}</td><td>${a} - ${b}</td>
            <td style="font-weight:700;color:#388700;">${win}</td>
          </tr>`;
        });
        out += `</table>`;
      });
      out += `</div>`;
    });
    document.getElementById('results-list').innerHTML = out;
  }
</script>
<script>
  // ---- STATS TABLE + SORTING ----
  function renderStatsTable() {
    if (!statsData.length) return;
    const cols = [
      "Player","Team","Sets Played","Sets Won","3 Dart Avg","First 9 Avg",
      "High Finish","100+","140+","180's","Win Rate (Legs)","Win Rate (Sets)"
    ];
    let s = document.getElementById('stats-search').value?.toLowerCase?.() || "";
    filteredStats = statsData.filter(r => (r.Player||"").toLowerCase().includes(s));
    doStatsTable(filteredStats, cols);

    document.getElementById('stats-search').oninput = () => {
      let s = document.getElementById('stats-search').value.toLowerCase();
      let data = statsData.filter(r => (r.Player||"").toLowerCase().includes(s));
      doStatsTable(data, cols);
    };

    function doStatsTable(rows, cols) {
      let ths = cols.map(c =>
        `<th data-col="${c}" style="cursor:pointer">${c} <span style="font-size:0.92em;opacity:.56">${
          lastSort.col===c ? (lastSort.asc ? "▲" : "▼") : ""
        }</span></th>`
      ).join('');
      let trs = rows.map(r => `<tr>` + cols.map(c => {
        if (c==="Player") {
          return `<td><button class="player-link" onclick="showPlayerPopup('${encodeURIComponent(r.Player)}')">${r.Player}</button></td>`;
        } else if (c.startsWith("Win Rate")) {
          let v = asNum(r[c]);
          return `<td>${v!=null ? (v*100).toFixed(1)+"%" : ""}</td>`;
        } else {
          return `<td>${r[c]||""}</td>`;
        }
      }).join('') + `</tr>`).join('');
      document.getElementById('stats-table').innerHTML = `<tr>${ths}</tr>${trs}`;

      // Add sorting
      document.querySelectorAll('#stats-table th').forEach((th,i) => {
        th.onclick = () => {
          let col = th.getAttribute('data-col');
          lastSort.asc = lastSort.col===col ? !lastSort.asc : true;
          lastSort.col = col;
          rows.sort((a,b) => {
            let av = asNum(a[col]), bv = asNum(b[col]);
            if (av!=null && bv!=null) return lastSort.asc ? av-bv : bv-av;
            return lastSort.asc 
              ? (""+a[col]).localeCompare(b[col]) 
              : (""+b[col]).localeCompare(a[col]);
          });
          doStatsTable(rows, cols);
        };
      });
    }
  }

  // ---- TOP 10 PAGE ----
  function renderTop10Tables() {
    if (!statsData.length || !standingsData.length) return;
    const cats = [
      { label:"MVP", key:"MVP", compute:calcMVPScore, min:2, info: true },
      { label:"3 Dart Avg", key:"3 Dart Avg", min:2 },
      { label:"First 9 Avg", key:"First 9 Avg", min:2 },
      { label:"100+ Scores", key:"100+", min:2 },
      { label:"High Finish", key:"High Finish", min:2 }
    ];
    let out = '';
    cats.forEach(cat => {
      let el = statsData.filter(p=>+p["Match Played"]>=cat.min);
      if (cat.compute) el.forEach(p=> p._MVP = cat.compute(p));
      if (cat.key==="100+") el.forEach(p=> p._100Total = (+p["100+"]||0)+(+p["140+"]||0)+(+p["170+"]||0)+(+p["180's"]||0));
      el.sort((a,b) => {
        if (cat.compute) return b._MVP - a._MVP;
        if (cat.key==="100+") return b._100Total - a._100Total;
        return (+b[cat.key]||0) - (+a[cat.key]||0);
      });
      let top = el.slice(0,10);
      out += `<div style="margin-bottom:34px">
        <div style="font-weight:700;font-size:1.13em;color:var(--primary);margin:7px 0 7px 0;">
          Top 10 ${cat.label}
          ${cat.info ? `<span style="background:#fff5;border-radius:50%;padding:2.5px 8px;font-weight:900;color:#3389c8;margin-left:10px;cursor:pointer;" onclick="showMvpInfo()" title="How is MVP calculated?">i</span>` : ''}
        </div>
        <table class="top10-table">
        <tr><th>Rank</th><th>Player</th><th>Team</th><th>${cat.label}</th></tr>`;
      top.forEach((p,i) => {
        let v = cat.compute ? p._MVP.toFixed(3)
           : cat.key==="100+" ? p._100Total : p[cat.key];
        out += `<tr>
          <td>#${i+1}</td>
          <td><button onclick="showPlayerPopup('${encodeURIComponent(p.Player)}')" class="player-link">${p.Player}</button></td>
          <td>${p.Team}</td>
          <td>${v}</td>
        </tr>`;
      });
      out += `</table></div>`;
    });
    document.getElementById('top10-tables').innerHTML = out;
  }

  // ---- MVP CALCULATION ----
  function calcMVPScore(p) {
  // Guard for empty/invalid data
  if (!statsData.length || !standingsData.length) return 0;
  // Only count those with legs played
  let valid = statsData.filter(x=>asNum(x["Match Played"])>=2 && asNum(x["3 Dart Avg"]) && asNum(x["Legs Played"]) && asNum(x["Legs Won"]));
  if (!valid.length) return 0;
  // 1. NormAvg: Player 3DAvg / Max 3DAvg
  let max3D = Math.max(...valid.map(x=>asNum(x["3 Dart Avg"])||0));
  let normAvg = (asNum(p["3 Dart Avg"])||0) / (max3D||1);
  // 2. NormWinRate: (LegsWon/LegsPlayed) / MaxWinRate
  let playerWinRate = (asNum(p["Legs Played"])>0) ? ((asNum(p["Legs Won"])||0)/(asNum(p["Legs Played"])||1)) : 0;
  let maxWinRate = Math.max(...valid.map(x=>(asNum(x["Legs Played"])>0)?((asNum(x["Legs Won"])||0)/(asNum(x["Legs Played"])||1)):0));
  let normWinRate = playerWinRate / (maxWinRate||1);
  // 3. NormLegsWon: Player LegsWon / Max LegsWon
  let maxLegsWon = Math.max(...valid.map(x=>asNum(x["Legs Won"])||0));
  let normLegsWon = (asNum(p["Legs Won"])||0)/(maxLegsWon||1);
  // 4. NormHighFinish: Player HighFinish / Max HighFinish
  let maxHF = Math.max(...valid.map(x=>asNum(x["High Finish"])||0));
  let normHF = (asNum(p["High Finish"])||0)/(maxHF||1);
  // 5. Norm180s: Player 180's / Max 180's
  let max180 = Math.max(...valid.map(x=>asNum(x["180's"])||0));
  let norm180 = (asNum(p["180's"])||0) / (max180 || 1);
  // 6. TeamSuccessScore: 1 - ((TeamRank-1)/(TotalTeams-1))
  let playerTeam = (p.Team||"").trim();
  let group = standingsData.find(x=>x.Team===playerTeam)?.Group || null;
  let teamsThisGroup = standingsData.filter(x=>x.Group===group);
  let sorted = [...teamsThisGroup].sort((a,b)=>(+b.Points||0)-(+a.Points||0));
  let teamRank = sorted.findIndex(t=>t.Team===playerTeam)+1;
  let totalTeams = sorted.length;
  let teamSuccess = (totalTeams>1) ? 1-((teamRank-1)/(totalTeams-1)) : 1;
  // Weighted formula (total 1.0)
  return (
    (normAvg*0.40) +
    (normWinRate*0.25) +
    (normLegsWon*0.20) +
    (normHF*0.05) +
    (norm180*0.05) +
    (teamSuccess*0.05)
  );
}
  window.showMvpInfo = function() {
    showCustomPopup(`
      <div style="background:#fff;border-radius:18px;box-shadow:0 8px 40px #0003;padding:19px 17px 13px 17px;min-width:240px;max-width:98vw;">
        <button style="position:absolute;top:7px;right:13px;font-size:2em;color:#888;background:none;border:none;cursor:pointer;" onclick="closeCustomPopup()" aria-label="Close">&times;</button>
        <div style="font-weight:700;font-size:1.11em;margin:4px 0 14px 0;color:var(--primary);">How is MVP calculated?</div>
        <div style="font-size:1.01em;line-height:1.56">
        <b>MVP Score =</b> (NormAvg × 0.40) + (NormWinRate × 0.25) + (NormLegsWon × 0.20) + (NormHighFinish × 0.05) + (TeamSuccess × 0.10)<br><br>
        <b>Where:</b><br>
        NormAvg = Player’s 3DAvg ÷ Highest 3DAvg<br>
        NormWinRate = (LegsWon ÷ LegsPlayed) ÷ Highest Win Rate<br>
        NormLegsWon = LegsWon ÷ Highest LegsWon<br>
        NormHighFinish = Player’s HighFinish ÷ Highest HighFinish<br>
        TeamSuccess = 1 - ((TeamRank-1) ÷ (TotalTeams-1))<br><br>
        <i>This method rewards individual performance & consistency as well as team achievement.</i>
        </div>
      </div>
    `);
  };

  // ---- SQUADS PAGE ----
  function renderSquadsList() {
    if (!statsData.length) return;
    let byTeam = {};
    statsData.forEach(p => (byTeam[p.Team] = byTeam[p.Team]||[]).push(p));
    let teams = Object.keys(byTeam).sort();
    let sel = document.getElementById('squad-team-filter');
    if (sel.innerHTML === "" || sel.options.length !== teams.length+1) {
      sel.innerHTML = `<option value="">All Teams</option>` + teams.map(t=>`<option>${t}</option>`).join('');
    }
    sel.onchange = renderSquadsList;
    let filter = sel.value;
    let showTeams = filter ? [filter] : teams;
    let out = '';
    showTeams.forEach(team => {
      let players = byTeam[team];
      out += `<div style="margin-bottom:19px">
        <div style="font-size:1.13em;font-weight:700;color:var(--primary);margin-bottom:5px;cursor:pointer;" onclick="showTeamStats('${encodeURIComponent(team)}')" title="Show stats for this team">
          ${team} <span style="color:#888;font-size:.94em;font-weight:600">(Tap for stats)</span>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;">`;
      players.forEach(p=>{
        out += `<div style="background:var(--surface);box-shadow:0 2px 8px #0001;border-radius:14px;padding:10px 7px 11px 7px;text-align:center;min-height:72px;">
          <button class="player-link" style="font-size:1.05em;font-weight:600" onclick="showPlayerPopup('${encodeURIComponent(p.Player)}')">
            ${p.Player}
          </button>
          <div style="color:#888;font-size:0.94em;margin-top:2px;">${p["Sets Played"]||""} Sets, ${p["3 Dart Avg"]||""} 3DA</div>
        </div>`;
      });
      out += `</div></div>`;
    });
    document.getElementById('squads-list').innerHTML = out;
  }

  // ---- POPUPS: PLAYER + TEAM ----
  window.showPlayerPopup = function(nameEnc) {
    let name = decodeURIComponent(nameEnc);
    let p = statsData.find(x=>x.Player===name);
    if (!p) return;
    let img = `<img src="https://i.postimg.cc/jSXT8DK8/temp-Image-El-Y5kn.avif" alt="Player Photo" style="width:62px;height:62px;border-radius:50%;background:#fff;margin-bottom:7px;">`;
    function grp(lbl, keys) {
      let rows = keys.filter(k=>p[k]!=null).map(k=>
        `<tr><td style="font-weight:600;color:#555;">${k}</td><td style="font-weight:700;color:var(--accent);">${k.includes("Win Rate")? (asNum(p[k])*100).toFixed(1)+"%":p[k]}</td></tr>`
      ).join('');
      return rows ? `<div style="color:var(--primary);font-weight:700;margin:7px 0 4px 0;font-size:1.05em;">${lbl}</div>
        <table style="width:100%;margin-bottom:2px;font-size:.97em;">${rows}</table>` : '';
    }
    let core = ["Sets Played","Sets Won","3 Dart Avg","First 9 Avg","High Finish","100+","140+","180's"];
    let win  = ["Match Played","Win Rate (Legs)","Win Rate (Sets)","Legs Played","Legs Won","Legs Diff"];
    let ex   = ["Best Leg","Worst Leg"];
    let other = Object.keys(p).filter(k=>![...core, ...win, ...ex].includes(k));
    let sections = `<div>
      ${grp("Core Stats", core)}
      ${grp("Win & Rates", win)}
      ${grp("Highlights", ex)}
      ${grp("Other", other)}
    </div>`;
    showCustomPopup(`
      <div style="background:#fff;border-radius:18px;box-shadow:0 8px 40px #0003;padding:17px 9px 12px 9px;max-width:330px;min-width:0;display:flex;flex-direction:column;align-items:center;">
        <button style="position:absolute;top:7px;right:13px;font-size:2em;color:#888;background:none;border:none;cursor:pointer;" onclick="closeCustomPopup()" aria-label="Close">&times;</button>
        ${img}
        <div style="font-size:1.18rem;font-weight:800;color:var(--primary);margin-top:5px;">${p.Player}</div>
        <div style="font-size:1.04rem;color:#555;margin-bottom:7px;">${p.Team}</div>
        ${sections}
      </div>
    `);
  };

  window.showTeamStats = function(teamEnc) {
    let team = decodeURIComponent(teamEnc);
    let players = statsData.filter(p=>p.Team===team);
    if (!players.length) return;
    const cols = [
      "Player","Sets Played","Sets Won","3 Dart Avg","First 9 Avg",
      "High Finish","100+","140+","180's","Win Rate (Legs)","Win Rate (Sets)"
    ];
    let ths = cols.map(c=>`<th>${c}</th>`).join('');
    let trs = players.map(p=>'<tr>'+cols.map(c=>{
      if(c==="Player") return `<td><button class="player-link" onclick="showPlayerPopup('${encodeURIComponent(p.Player)}')">${p.Player}</button></td>`;
      if (c.startsWith("Win Rate")) {
        let v = asNum(p[c]);
        return `<td>${v!=null ? (v*100).toFixed(1)+"%" : ""}</td>`;
      }
      return `<td>${p[c]||""}</td>`;
    }).join('')+'</tr>').join('');
    showCustomPopup(`
      <div style="background:#fff;border-radius:18px;box-shadow:0 8px 40px #0003;padding:10px 7px 18px 7px;max-width:560px;width:99vw;">
        <div style="background:var(--chip);border-bottom:1px solid #ececec;padding:12px 20px 8px 16px;color:var(--primary);font-size:1.14em;font-weight:800;text-align:center;position:sticky;top:0;z-index:2;">
          All Player Stats for ${team}
          <button style="position:absolute;top:8px;right:14px;font-size:2em;color:#888;background:none;border:none;cursor:pointer;" onclick="closeCustomPopup()" aria-label="Close">&times;</button>
        </div>
        <div style="overflow:auto;padding:13px 5px 15px 5px;">
          <table class="stats-table" style="width:100%">
            <tr>${ths}</tr>${trs}
          </table>
        </div>
      </div>
    `);
  };

  // ---- UNIVERSAL POPUP ----
  function showCustomPopup(html) {
    let pb = document.getElementById('popup-backdrop');
    if (!pb) {
      pb = document.createElement('div');
      pb.id = 'popup-backdrop';
      pb.className = 'popup-backdrop';
      pb.tabIndex = -1;
      document.body.appendChild(pb);
    }
    pb.innerHTML = html;
    pb.classList.add('show');
    pb.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    pb.scrollTop = 0;
    pb.onclick = function(e) { if (e.target === pb) closeCustomPopup(); };
  }
  function closeCustomPopup() {
    let pb = document.getElementById('popup-backdrop');
    if (!pb) return;
    pb.classList.remove('show');
    setTimeout(()=>{pb.style.display='none';},180);
    document.body.style.overflow = '';
  }
  window.closeCustomPopup = closeCustomPopup;
</script>
<script src="main.js"></script>
</body>
</html>
